# %%
import numpy as np
import matplotlib.pyplot as plt

# %%
# Re-define the datasets
datasets = [
    (
        "Road Classification",
        ["A Roads", "B Roads", "Motorway"],
        [[1.17, 0.29, 0], [8.12, 2.25, 0], [4.64, 1.27, 0]],
    ),
    (
        "Form of Way",
        ["Collapsed Dual", "Dual", "Roundabout", "Single", "Slip Roads"],
        [
            [0.27, 0.03, 0.04, 1.11, 0],  # min
            [1.06, 0.34, 0.48, 8.49, 0.01],  # max
            [0.66, 0.18, 0.26, 4.8, 0.015],  # mean
        ],
    ),
    (
        "Road Structure",
        ["Others", "Bridge", "Tunnel"],
        [
            [0.83, 0.63, 0.00],
            [9.43, 0.94, 0.00],
            [5.13, 0.78, 0.00],
        ],
    ),
    (
        "Trunk Road",
        ["Trunk", "Principal"],
        [[0, 1.46], [0, 10.37], [0, 5.91]],
    ),
    (
        "Urban Road",
        ["Urban", "Suburban"],
        [[0.1, 1.35], [1.11, 9.25], [0.61, 5.3]],
    ),
]

# pre-define font styles
plt.rcParams["font.size"] = 14
plt.rcParams["font.family"] = "Times New Roman"
plt.rcParams["axes.titlesize"] = 26  # Title font size
plt.rcParams["axes.labelsize"] = 14  # Axis labels
plt.rcParams["xtick.labelsize"] = 14
plt.rcParams["ytick.labelsize"] = 14

# Create a figure with a 2x3 layout
fig, axes = plt.subplots(2, 3, figsize=(18, 12), subplot_kw=dict(polar=True))

# Add a main title for the figure
fig.suptitle(
    "Comparison of Road Vulnerability (in £million) Across Categories",
    fontsize=24,
    fontweight="bold",
    y=1.02,
)

# Flatten axes for easy iteration
axes = axes.flatten()

# Colors for min, max, mean
colors = ["blue", "red", "green"]
labels = ["Min", "Max", "Mean"]

# Iterate over each dataset and create a radar chart
for i, (title, categories, values) in enumerate(datasets):
    ax = axes[i]
    num_vars = len(categories)
    angles = np.linspace(0, 2 * np.pi, num_vars, endpoint=False).tolist()
    angles += angles[:1]  # Close the radar chart loop

    # for j, value in enumerate(values):
    #     val = value + [value[0]]  # Close the loop for radar plot
    #     ax.plot(angles, val, color=colors[j], linewidth=2, label=labels[j])
    #     ax.fill(angles, val, color=colors[j], alpha=0.2)
    mean_values = values[2] + [values[2][0]]  # Select only mean and close loop
    ax.plot(angles, mean_values, color="blue", linewidth=2, label="Mean")
    ax.fill(angles, mean_values, color="blue", alpha=0.2)

    ax.set_xticks(angles[:-1])
    ax.set_xticklabels(categories, fontsize=18)
    ax.set_title(title, fontsize=20, fontweight="bold", pad=20)

# Remove the empty subplot (since we have 5 datasets but 6 slots in 2x3 layout)
fig.delaxes(axes[-1])

# Add a legend
handles, labels = ax.get_legend_handles_labels()
fig.legend(handles, labels, loc="upper right", bbox_to_anchor=(1.05, 1))

# Adjust layout and display the plot
plt.tight_layout()
plt.savefig(
    r"C:\Oxford\Research\DAFNI\local\papers\figures\vulnerability-mean.png",
    dpi=300,
    bbox_inches="tight",
)

plt.show()

# %%
# updated version
# Data from the table
categories = [
    "A Roads",
    "B Roads",
    "Motorway",
    "Collapsed Dual",
    "Dual",
    "Roundabout",
    "Single",
    "Slip Roads",
    "Ordinary Roads",
    "Bridge",
    "Tunnel",
    "Trunk Roads",
    "Principal Roads",
    "Urban Roads",
    "Suburban Roads",
]

mean_values = [
    4.64,
    1.27,
    0,
    0.66,
    0.18,
    0.26,
    4.8,
    0.015,
    5.13,
    0.78,
    0,
    0.61,
    5.3,
    0.61,
    5.3,
]

min_values = [
    1.17,
    0.29,
    0,
    0.27,
    0.03,
    0.04,
    1.11,
    0,
    0.83,
    0.63,
    0,
    0,
    1.46,
    0.1,
    1.35,
]

max_values = [
    8.12,
    2.25,
    0,
    1.06,
    0.34,
    0.48,
    8.49,
    0.01,
    9.43,
    0.94,
    0,
    1.11,
    9.25,
    1.11,
    9.25,
]


# Ensure error bars are non-negative
error_bars = np.array(
    [
        np.maximum(0, np.array(mean_values) - np.array(min_values)),
        np.maximum(0, np.array(max_values) - np.array(mean_values)),
    ]
)

# Define colours for different groups
group_colors = [
    "#264653",
    "#264653",
    "#264653",  # Road Classification (Blue)
    "#2a9d8f",
    "#2a9d8f",
    "#2a9d8f",
    "#2a9d8f",
    "#2a9d8f",  # Form of Way (Orange)
    "#e9c46a",
    "#e9c46a",
    "#e9c46a",  # Road Structure (Green)
    "#f4a261",
    "#f4a261",  # Trunk or Principal (Red)
    "#e76f51",
    "#e76f51",  # Urban or Suburban (Purple)
]

# pre-define font styles
plt.rcParams["font.size"] = 16
plt.rcParams["font.family"] = "Times New Roman"
plt.rcParams["axes.titlesize"] = 22  # Title font size
plt.rcParams["axes.labelsize"] = 16  # Axis labels
plt.rcParams["xtick.labelsize"] = 16
plt.rcParams["ytick.labelsize"] = 16

# Create the bar chart with different colours per group
fig, ax = plt.subplots(figsize=(12, 8))
x = np.arange(len(categories))
bars = ax.bar(
    x,
    mean_values,
    yerr=error_bars,
    capsize=5,
    color=group_colors,
    edgecolor="black",
    error_kw={"ecolor": "grey", "elinewidth": 1.5, "linestyle": "--"},
)

# Formatting
ax.set_xticks(x)
ax.set_xticklabels(categories, rotation=45, ha="right")
ax.set_ylabel("Direct damage costs (£million)")
ax.set_title(
    "Comparison of Road Vulnerability Across Categories", pad=10, fontweight="bold"
)
ax.set_ylim(0, 10)  # Set y-axis limits
ax.axhline(0, color="black", linewidth=0.8)  # Add a horizontal line at y=0
plt.grid(axis="y", linestyle="--", alpha=0.7)

# Create a legend for groups
group_labels = [
    "Road Classification",
    "Form of Way",
    "Road Structure",
    "Trunk or Principal",
    "Urban or Suburban",
]
legend_patches = [
    plt.Line2D([0], [0], color=color, lw=6)
    for color in ["#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51"]
]
ax.legend(legend_patches, group_labels, loc="upper right")

# Show the plot
plt.tight_layout()
plt.savefig(
    r"C:\Oxford\Research\DAFNI\local\papers\figures\road_vulnerability.png",
    dpi=300,
    bbox_inches="tight",
)
plt.show()
